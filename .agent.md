# Laravel Nusa - Project Analysis Summary

## Project Overview

**Laravel Nusa** (`creasi/laravel-nusa`) is a comprehensive Laravel package that provides Indonesian administrative region data including provinces, regencies (kabupaten/kota), districts (kecamatan), and villages (kelurahan/desa). The package aims to be "ready-to-use once installed" without requiring data migration or seeding processes.

### Key Features
- Complete Indonesian administrative hierarchy data
- Geographic coordinates and postal codes
- RESTful API endpoints
- Eloquent models with relationships
- SQLite database for performance and portability
- Address management system with traits
- Automated data synchronization from upstream sources

## Architecture & Design

### Core Philosophy
The package follows a "zero-configuration" approach where:
- Data is pre-packaged in SQLite format (~10MB distribution, ~407MB with coordinates)
- No manual seeding required
- Separate database connection to avoid conflicts
- Ready-to-use API endpoints upon installation

### Database Structure
```
Province (1) → (*) Regency (1) → (*) District (1) → (*) Village
```

**Tables:**
- `provinces`: 38 records (code, name, latitude, longitude, coordinates)
- `regencies`: 514 records (includes cities and regencies)
- `districts`: 7,285 records (sub-districts/kecamatan)
- `villages`: 83,762 records (villages/kelurahan with postal codes)

### Data Sources
The package integrates data from multiple upstream repositories:
- `cahyadsn/wilayah` - Core administrative data
- `cahyadsn/wilayah_kodepos` - Postal code mappings
- `cahyadsn/wilayah_boundaries` - Geographic boundaries and coordinates

## Technical Implementation

### Package Structure
```
src/
├── Contracts/          # Interface definitions
├── Http/
│   ├── Controllers/    # API controllers
│   ├── Requests/       # Request validation
│   └── Resources/      # API resources
├── Models/             # Eloquent models
│   ├── Concerns/       # Reusable traits
│   └── Model.php       # Base model
└── ServiceProvider.php # Laravel service provider

workbench/              # Development environment
├── app/Console/        # Data management commands
└── submodules/         # Upstream data sources
```

### Key Models
- `Province`: Top-level administrative division
- `Regency`: Second-level (kabupaten/kota)
- `District`: Third-level (kecamatan)
- `Village`: Fourth-level (kelurahan/desa)
- `Address`: Extensible address model for applications

### API Endpoints
All endpoints support pagination, search, and filtering:
- `GET /nusa/provinces` - List provinces
- `GET /nusa/provinces/{code}` - Show province
- `GET /nusa/provinces/{code}/regencies` - Province's regencies
- Similar patterns for regencies, districts, and villages

### Development Tools

#### Console Commands

- `composer upstream` - Interact with Docker services
- `composer upstream:up` - Start Docker services (MySQL)
- `composer upstream:down` - Stop Docker services
- `composer testbench nusa:import` - Import data from upstream sources
- `composer testbench nusa:dist` - Create distribution database (removes coordinates for privacy)
- `composer testbench nusa:stat` - Generate statistics and change reports
- `composer testbench nusa:generate-static` - Generate static data files

#### Data Management Workflow
1. **Import**: Pull data from upstream submodules
2. **Process**: Normalize and validate data
3. **Distribute**: Create privacy-compliant distribution database
4. **Deploy**: Package with the library

## Development Environment

### Requirements
- PHP ≥8.2 with SQLite extension
- Laravel ≥9.0 (supports up to Laravel 12.0)
- Node.js with pnpm for development tools

### Testing & Quality
- PHPUnit test suite with Orchestra Testbench
- Laravel Pint for code formatting
- Conventional Commits with commitlint
- GitHub Actions for CI/CD

### Database Management
The project maintains multiple database files:
- `nusa.sqlite` - Distribution database (10MB, no coordinates)
- `nusa.{branch}-full.sqlite` - Development database (407MB, with coordinates)
- Automated backup and versioning system

## CI/CD & Automation

### GitHub Workflows
- **Tests**: Run on multiple PHP/Laravel versions
- **Distribution**: Auto-generate distribution database
- **Dependabot Integration**: Automatic upstream data updates
- **Release**: Automated versioning with standard-version

### Automated Data Updates
When upstream sources update:
1. Dependabot creates PR with submodule updates
2. Workflow imports fresh data automatically
3. Distribution database is regenerated
4. Changes are committed with detailed statistics
5. Artifacts are uploaded for backup

## Configuration & Customization

### Default Configuration
```php
'connection' => 'nusa',           // Database connection name
'routes_enable' => true,          // Enable API routes
'routes_prefix' => 'nusa',        // API route prefix
'addressable' => Address::class,  // Address model implementation
```

### Extensibility
- Custom database connections supported
- Configurable table names
- Extensible Address model
- Trait-based address relationships (`WithAddress`, `WithAddresses`)

## Usage Patterns

### Basic Model Usage
```php
use Creasi\Nusa\Models\Province;

$province = Province::search('Jawa Tengah')->first();
$regencies = $province->regencies;
$postalCodes = $province->postal_codes; // Aggregated postal codes
```

### Address Integration
```php
use Creasi\Nusa\Contracts\HasAddresses;
use Creasi\Nusa\Models\Concerns\WithAddresses;

class User extends Model implements HasAddresses
{
    use WithAddresses;
}
```

## Project Status & Roadmap

### Current Version: 0.1.14
- ✅ Complete administrative hierarchy
- ✅ Geographic coordinates and boundaries
- ✅ RESTful API with pagination
- ✅ Automated upstream synchronization
- ✅ Privacy-compliant distribution

### Recent Enhancements
- Enhanced change detection and reporting
- Improved import process with concurrency
- Better CI/CD automation
- Comprehensive testing coverage

## Development Guidelines

### Contributing
1. Clone with submodules: `git clone --recurse-submodules`
2. Install dependencies: `composer install && pnpm install`
3. Setup environment: Configure `workbench/.env`
4. Initialize databases: `composer upstream:up` or manual setup
5. Run tests: `composer test`

### Code Standards
- Laravel Pint with Laravel preset
- Conventional Commits
- PHPDoc annotations
- Strict typing (`declare(strict_types=1)`)

This package represents a mature, production-ready solution for Indonesian administrative data with excellent automation, testing, and maintenance practices.
